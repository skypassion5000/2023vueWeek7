import{M as b}from"./bootstrap.esm-uhsrVe-H.js";import{P as L}from"./PaginationComponent-WKwSBfEi.js";import{_ as k,r as C,o as d,c as i,b as g,e as o,F as f,h as V,t as u,d as m,j as p,v as c,q as w}from"./index-4OsAil_u.js";var P={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"vuejs",BASE_URL:"/2023vueWeek7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:r,VITE_PATH:h}=P,D={data(){return{coupons:{},due_date:"",tempCoupon:{title:"",is_enabled:0,percent:100,code:"",due_date:""},isLoading:!1,isNew:!1,couponModal:null,delCouponModal:null,currentPage:1,pagination:{}}},methods:{openCouponModal(n,t){this.isNew=n,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...t},this.couponModal.show()},openDelCouponModal(n){this.tempCoupon={...n},this.delCouponModal.show()},updateCoupon(n){this.isLoading=!0;let t=`${r}/v2/api/${h}/admin/coupon`,l="post",_=n;this.isNew||(t=`${r}/v2/api/${h}/admin/coupon/${this.tempCoupon.id}`,l="put",_=this.tempCoupon),this.$http[l](t,{data:_}).then(e=>{this.isLoading=!1,alert(e.data.message),console.log(e.data),this.getCoupons(),this.couponModal.hide()}).catch(e=>{this.isLoading=!1,alert(e.response.data.message)})},delCoupon(){const n=`${r}/v2/api/${h}/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(n).then(()=>{this.isLoading=!1,this.delCouponModal.hide(),this.getCoupons()}).catch(t=>{this.isLoading=!1,alert(t.response.data.message)})},getCoupons(n=1){this.currentPage=n,this.isLoading=!0;const t=`${r}/v2/api/${h}/admin/coupons?page=${n}`;this.$http.get(t,this.tempProduct).then(l=>{this.coupons=l.data.coupons,this.pagination=l.data.pagination,this.isLoading=!1}).catch(l=>{this.isLoading=!1,alert(l.response.data.message)})}},components:{PaginationComponents:L},mounted(){this.couponModal=new b(this.$refs.couponModal),this.delCouponModal=new b(this.$refs.delCouponModal),this.getCoupons()}},E={class:"container"},T={class:"text-end mt-4"},N={class:"table mt-4"},U=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),R={key:0,class:"text-success"},S={key:1,class:"text-muted"},B={class:"btn-group"},I=["onClick"],A=["onClick"],j={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delCouponModal"},z={class:"modal-dialog",role:"document"},F={class:"modal-content border-0"},H={class:"modal-header bg-danger text-white"},O={class:"modal-title"},W=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},G={class:"text-danger"},J={class:"modal-footer"},K=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1),Q={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"couponModal"},X={class:"modal-dialog",role:"document"},Y={class:"modal-content"},Z={class:"modal-header"},$={class:"modal-title",id:"exampleModalLabel"},oo={key:0},to={key:1},eo=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),so={class:"modal-body"},no={class:"mb-3"},lo=o("label",{for:"title"},"標題",-1),ao={class:"mb-3"},io=o("label",{for:"coupon_code"},"優惠碼",-1),uo={class:"mb-3"},po=o("label",{for:"due_date"},"到期日",-1),co={class:"mb-3"},ro=o("label",{for:"price"},"折扣百分比",-1),ho={class:"mb-3"},_o={class:"form-check"},mo=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),bo={class:"modal-footer"},Co=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function go(n,t,l,_,e,a){const v=C("VueLoading"),y=C("PaginationComponents");return d(),i(f,null,[g(v,{active:e.isLoading,"z-index":1060},null,8,["active"]),o("div",E,[o("div",T,[o("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=s=>a.openCouponModal(!0))}," 建立新的優惠券 ")]),o("table",N,[U,o("tbody",null,[(d(!0),i(f,null,V(e.coupons,(s,M)=>(d(),i("tr",{key:M},[o("td",null,u(s.title),1),o("td",null,u(s.percent)+"%",1),o("td",null,u(new Date(s.due_date*1e3).toLocaleDateString("zh-TW")),1),o("td",null,[s.is_enabled===1?(d(),i("span",R,"啟用")):(d(),i("span",S,"未啟用"))]),o("td",null,[o("div",B,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:x=>a.openCouponModal(!1,s)},"編輯",8,I),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:x=>a.openDelCouponModal(s)},"刪除",8,A)])])]))),128))])]),o("div",j,[o("div",z,[o("div",F,[o("div",H,[o("h5",O,[o("span",null,"刪除 "+u(e.tempCoupon.title),1)]),W]),o("div",q,[m(" 是否刪除 "),o("strong",G,u(e.tempCoupon.title),1),m(" (刪除後將無法恢復)。 ")]),o("div",J,[K,o("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(...s)=>a.delCoupon&&a.delCoupon(...s))},"確認刪除 ")])])])],512),o("div",Q,[o("div",X,[o("div",Y,[o("div",Z,[o("h5",$,[e.isNew?(d(),i("span",oo,"新增優惠卷")):(d(),i("span",to,"編輯優惠卷"))]),eo]),o("div",so,[o("div",no,[lo,p(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[2]||(t[2]=s=>e.tempCoupon.title=s),placeholder:"請輸入標題"},null,512),[[c,e.tempCoupon.title]])]),o("div",ao,[io,p(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[3]||(t[3]=s=>e.tempCoupon.code=s),placeholder:"請輸入優惠碼"},null,512),[[c,e.tempCoupon.code]])]),o("div",uo,[m(u(e.due_date)+" ",1),po,p(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[4]||(t[4]=s=>e.due_date=s)},null,512),[[c,e.due_date]])]),o("div",co,[ro,p(o("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[5]||(t[5]=s=>e.tempCoupon.percent=s),placeholder:"請輸入折扣百分比"},null,512),[[c,e.tempCoupon.percent,void 0,{number:!0}]])]),o("div",ho,[o("div",_o,[p(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[6]||(t[6]=s=>e.tempCoupon.is_enabled=s),id:"is_enabled"},null,512),[[w,e.tempCoupon.is_enabled]]),mo])])]),o("div",bo,[Co,o("button",{type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=s=>a.updateCoupon(e.tempCoupon))},u(e.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512),g(y,{pages:e.pagination,onEmitPages:a.getCoupons},null,8,["pages","onEmitPages"])])],64)}const Mo=k(D,[["render",go]]);export{Mo as default};
