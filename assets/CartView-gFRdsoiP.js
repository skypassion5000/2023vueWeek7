import{M as w}from"./bootstrap.esm-uhsrVe-H.js";import{_ as M,o as d,c as n,e as t,t as i,i as c,j as L,v as V,a as P,g as _,m as I,r as f,b as u,F as x,h as U,w as $,n as E,d as b,k}from"./index-4OsAil_u.js";import{c as S}from"./cartStore-NSUvlRRE.js";const A={props:{product:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",qty:1}},mounted(){this.modal=new w(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}}},B={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},D={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},R={class:"modal-header bg-dark text-white"},j={class:"modal-title",id:"exampleModalLabel"},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),N={class:"modal-body"},F={class:"row"},H={class:"col-sm-6"},W=["src"],G={class:"col-sm-6"},J={class:"badge bg-primary rounded-pill"},K={key:0,class:"h5"},Q={key:1,class:"h6"},X={key:2,class:"h5"},Y={class:"input-group"};function Z(a,e,o,g,l,m){return d(),n("div",B,[t("div",D,[t("div",O,[t("div",R,[t("h5",j,[t("span",null,i(o.product.title),1)]),z]),t("div",N,[t("div",F,[t("div",H,[t("img",{class:"img-fluid",src:o.product.imagesUrl,alt:""},null,8,W)]),t("div",G,[t("span",J,i(o.product.category),1),t("p",null,"商品描述："+i(o.product.description),1),t("p",null,"商品內容："+i(o.product.content),1),o.product.price?c("",!0):(d(),n("div",K,i(o.product.origin_price)+" 元",1)),o.product.price?(d(),n("del",Q,"原價 "+i(o.product.origin_price)+" 元",1)):c("",!0),o.product.price?(d(),n("div",X,"現在只要 "+i(o.product.price)+" 元",1)):c("",!0),t("div",null,[t("div",Y,[L(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":e[0]||(e[0]=v=>l.qty=v)},null,512),[[V,l.qty,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>a.$emit("add-to-cart",o.product.id,l.qty))},"加入購物車")])])])])])])])],512)}const tt=M(A,[["render",Z]]);var et={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"vuejs",BASE_URL:"/2023vueWeek7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_PATH:h}=et,st={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:"",delCartModal:null}},components:{UserProductModal:tt},computed:{...P(S,["carts","total","final_total"])},mounted(){this.getProducts(),this.getCart()},methods:{getProducts(){const a=`${p}/v2/api/${h}/products`;this.isLoading=!0,_.get(a).then(e=>{this.products=e.data.products,this.isLoading=!1}).catch(e=>{alert(e.response.data.message),this.isLoading=!1})},getProduct(a){const e=`${p}/v2/api/${h}/product/${a}`;this.isLoading=!0,this.loadingStatus.loadingItem=a,_.get(e).then(o=>{this.loadingStatus.loadingItem="",this.product=o.data.product,this.$refs.userProductModal.openModal(),this.isLoading=!1}).catch(o=>{alert(o.response.data.message),this.isLoading=!1})},...I(S,["getCart"]),...I(S,["addToCart"]),deleteAllCarts(){const a=`${p}/v2/api/${h}/carts`;this.isLoading=!0,_.delete(a).then(e=>{alert(e.data.message),this.getCart(),this.isLoading=!1}).catch(e=>{alert(e.response.data.message),this.isLoading=!1})},removeCartItem(a){const e=`${p}/v2/api/${h}/cart/${a}`;this.isLoading=!0,this.loadingStatus.loadingItem=a,_.delete(e).then(o=>{alert(o.data.message),this.loadingStatus.loadingItem="",this.getCart(),this.isLoading=!1}).catch(o=>{alert(o.response.data.message),this.isLoading=!1})},updateCart(a){const e=`${p}/v2/api/${h}/cart/${a.id}`;this.isLoading=!0,this.loadingStatus.loadingItem=a.id;const o={product_id:a.product_id,qty:a.qty};_.put(e,{data:o}).then(g=>{alert(g.data.message),this.loadingStatus.loadingItem="",this.getCart(),this.isLoading=!1}).catch(g=>{alert(g.response.data.message),this.isLoading=!1})},addCouponCode(){const a=`${p}/v2/api/${h}/coupon`,e={code:this.coupon_code};this.isLoading=!0,this.$http.post(a,{data:e}).then(o=>{alert(o.data.message),this.getCart(),this.isLoading=!1}).catch(o=>{this.isLoading=!1,alert(o.response.data.message)})},createOrder(){const a=`${p}/v2/api/${h}/order`;this.isLoading=!0;const e=this.form;_.post(a,{data:e}).then(o=>{alert(o.data.message),this.$router.push(`checkout/${o.data.orderId}`),this.$refs.form.resetForm(),this.getCart(),this.isLoading=!1}).catch(o=>{alert(o.response.data.message),this.isLoading=!1})}}},ot={class:"mt-4"},at=t("h2",null,"購物車列表",-1),lt={class:"table align-middle"},dt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),nt={style:{width:"200px"}},it={key:0,class:"h5"},rt={key:1,class:"h6"},ct={key:2,class:"h5"},ut={class:"btn-group btn-group-sm"},mt=["onClick","disabled"],pt={key:0,class:"fas fa-spinner fa-pulse"},ht=["onClick"],_t={key:0,class:"fas fa-spinner fa-pulse"},gt={class:"text-end"},ft={class:"table align-middle"},bt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),vt=["onClick","disabled"],yt={key:0,class:"fas fa-spinner fa-pulse"},Ct={key:0,class:"text-success"},kt={class:"input-group input-group-sm"},Lt={class:"input-group mb-3"},Vt=["onUpdate:modelValue","onBlur","disabled"],xt={class:"input-group-text",id:"basic-addon2"},St={class:"text-end"},It={key:0,class:"text-success"},Ut=t("td",{colspan:"3",class:"text-end"},"總計",-1),Mt={class:"text-end"},Tt={key:0},qt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),wt={class:"text-end text-success"},Pt={class:"input-group mb-3 input-group-sm"},$t={class:"input-group-append"},Et={class:"my-5 row justify-content-center"},At={class:"mb-3"},Bt=t("label",{for:"email",class:"form-label"},"Email",-1),Dt={class:"mb-3"},Ot=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Rt={class:"mb-3"},jt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),zt={class:"mb-3"},Nt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Ft={class:"mb-3"},Ht=t("label",{for:"message",class:"form-label"},"留言",-1),Wt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function Gt(a,e,o,g,l,m){const v=f("VueLoading"),y=f("v-field"),C=f("error-message"),T=f("v-form"),q=f("UserProductModal");return d(),n(x,null,[u(v,{active:l.isLoading,"z-index":1060},null,8,["active"]),t("div",ot,[at,t("table",lt,[dt,t("tbody",null,[(d(!0),n(x,null,U(l.products,s=>(d(),n("tr",{key:s.id},[t("td",nt,[t("div",{style:E([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),t("td",null,i(s.title),1),t("td",null,[s.price?c("",!0):(d(),n("div",it,i(s.origin_price)+" 元",1)),s.price?(d(),n("del",rt,"原價 "+i(s.origin_price)+" 元",1)):c("",!0),s.price?(d(),n("div",ct,"現在只要 "+i(s.price)+" 元",1)):c("",!0)]),t("td",null,[t("div",ut,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:r=>m.getProduct(s.id),disabled:l.loadingStatus.loadingItem===s.id||!s.is_enabled},[l.loadingStatus.loadingItem===s.id?(d(),n("i",pt)):c("",!0),b(" 查看更多 ")],8,mt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:r=>a.addToCart(s.id)},[l.loadingStatus.loadingItem===s.id?(d(),n("i",_t)):c("",!0),b(" 加到購物車 ")],8,ht)])])]))),128))])]),t("div",gt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...s)=>m.deleteAllCarts&&m.deleteAllCarts(...s))}," 清空購物車 ")]),t("table",ft,[bt,t("tbody",null,[a.carts&&a.carts.length>0?(d(!0),n(x,{key:0},U(a.carts,s=>(d(),n("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>m.removeCartItem(s.id),disabled:l.loadingStatus.loadingItem===s.id},[l.loadingStatus.loadingItem===s.id?(d(),n("i",yt)):c("",!0),b(" x ")],8,vt)]),t("td",null,[b(i(s.product.title)+" ",1),s.coupon?(d(),n("div",Ct,"已套用優惠券")):c("",!0)]),t("td",null,[t("div",kt,[t("div",Lt,[L(t("input",{"onUpdate:modelValue":r=>s.qty=r,onBlur:r=>m.updateCart(s),disabled:l.loadingStatus.loadingItem===s.id,min:"1",type:"number",class:"form-control"},null,40,Vt),[[V,s.qty,void 0,{number:!0}]]),t("span",xt,i(s.product.unit),1)])])]),t("td",St,[a.final_total!==a.total?(d(),n("small",It,"折扣價：")):c("",!0),b(" "+i(s.final_total),1)])]))),128)):c("",!0)]),t("tfoot",null,[t("tr",null,[Ut,t("td",Mt,i(l.cart.total),1)]),a.final_total!==a.total?(d(),n("tr",Tt,[qt,t("td",wt,i(a.final_total),1)])):c("",!0)])]),t("div",Pt,[L(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=s=>l.coupon_code=s),placeholder:"請輸入優惠碼"},null,512),[[V,l.coupon_code]]),t("div",$t,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=(...s)=>m.addCouponCode&&m.addCouponCode(...s))}," 套用優惠碼 ")])]),t("div",Et,[u(T,{ref:"form",class:"col-md-6",onSubmit:m.createOrder},{default:$(({errors:s})=>[t("div",At,[Bt,u(y,{id:"email",name:"email",type:"email",class:k(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":e[3]||(e[3]=r=>l.form.user.email=r)},null,8,["class","modelValue"]),u(C,{name:"email",class:"invalid-feedback"})]),t("div",Dt,[Ot,u(y,{id:"name",name:"姓名",type:"text",class:k(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":e[4]||(e[4]=r=>l.form.user.name=r)},null,8,["class","modelValue"]),u(C,{name:"姓名",class:"invalid-feedback"})]),t("div",Rt,[jt,u(y,{id:"tel",name:"電話",type:"text",class:k(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":e[5]||(e[5]=r=>l.form.user.tel=r)},null,8,["class","modelValue"]),u(C,{name:"電話",class:"invalid-feedback"})]),t("div",zt,[Nt,u(y,{id:"address",name:"地址",type:"text",class:k(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":e[6]||(e[6]=r=>l.form.user.address=r)},null,8,["class","modelValue"]),u(C,{name:"地址",class:"invalid-feedback"})]),t("div",Ft,[Ht,L(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[7]||(e[7]=r=>l.form.message=r)},null,512),[[V,l.form.message]])]),Wt]),_:1},8,["onSubmit"])])]),u(q,{ref:"userProductModal",product:l.product,onAddToCart:a.addToCart},null,8,["product","onAddToCart"])],64)}const Xt=M(st,[["render",Gt]]);export{Xt as default};
